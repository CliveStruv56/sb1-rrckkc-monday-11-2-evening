import{a as C,j as e,d as A,u as F}from"./index-YCAMCxzv.js";import{R as o,u as I}from"./vendor-react-S76kyUnC.js";import{q as P,x as V,c as O,d as W}from"./vendor-firebase-DU3MYe4I.js";import{f as i,s as D,a as T,b as k,i as M,d as z}from"./vendor-utils-BGzRgZPY.js";const G=({onConfirm:m})=>{const[s,b]=o.useState(null),[r,u]=o.useState(""),[h,c]=o.useState(!1),[x,w]=o.useState({}),{settings:y}=C();o.useEffect(()=>{C.getState().fetchSettings()},[]);const p=o.useCallback(async t=>{const a=i(t,"yyyy-MM-dd"),l=P(O(A,"timeSlots"),V("date","==",a));try{const n=(await W(l)).docs.map(g=>g.data().time);w(g=>({...g,[a]:n}))}catch(d){console.error("Error fetching booked slots:",d)}},[]);o.useEffect(()=>{s&&p(s)},[s,p]);const f=o.useCallback(t=>{const a=[],l=D(T(t,45),10),d=D(T(t,30),15);let n=l;const g=k(new Date,15),q=i(t,"yyyy-MM-dd"),R=x[q]||[];for(;M(d,n);){const S=i(n,"HH:mm"),v=new Date(t),[H,B]=S.split(":").map(Number);v.setHours(H,B,0,0),M(v,g)&&a.push({time:S,available:!R.includes(S)}),n=k(n,15)}return a},[x]),j=o.useCallback(t=>{if(!y)return!1;const a=i(t,"yyyy-MM-dd");return!(y.blockedDates.includes(a)||f(t).length===0)},[y,f]),N=o.useMemo(()=>{const t=new Date,a=[];let l=t,d=0;for(;a.length<8&&d<30;){const n=l.getDay();(n===4||n===5||n===6||n===0)&&j(l)&&a.push({date:new Date(l),isToday:i(l,"yyyy-MM-dd")===i(t,"yyyy-MM-dd")}),l=z(l,1),d++}return a},[j]),E=()=>{s&&r&&(m(s,r),c(!0))},$=()=>{b(null),u(""),c(!1)};return y?e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Select Collection Date and Time"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Select Date:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:N.map(({date:t,isToday:a})=>e.jsx("button",{onClick:()=>{b(t),u(""),c(!1)},className:`p-3 rounded-lg border transition-colors ${(s==null?void 0:s.toDateString())===t.toDateString()?"bg-blue-600 text-white":"hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{children:i(t,"EEE, MMM d")}),a&&e.jsx("span",{className:"text-xs mt-1 font-medium text-green-600",children:"Today"})]})},t.toISOString()))}),N.length===0&&e.jsx("p",{className:"text-center text-gray-500 mt-4",children:"No available dates for collection. Please check back later."})]}),s&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Select Time:"}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-6 gap-3",children:f(s).map(({time:t,available:a})=>e.jsx("button",{onClick:()=>{a&&(u(t),c(!1))},disabled:!a,className:`p-2 rounded-lg border ${r===t?"bg-blue-600 text-white":a?"hover:bg-gray-50":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:t},t))})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("button",{onClick:E,disabled:!s||!r,className:`flex-1 py-3 px-4 rounded-lg text-white transition-colors ${h?"bg-green-700 hover:bg-green-800":"bg-green-600 hover:bg-green-700"} disabled:bg-gray-400`,children:h?"Selection Confirmed âœ“":"Confirm Selection"}),e.jsx("button",{onClick:$,className:"flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-300 transition-colors",children:"Reset"})]}),(s||r)&&e.jsxs("div",{className:`${h?"bg-green-50":"bg-gray-50"} p-4 rounded-lg transition-colors`,children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Current Selection:"}),e.jsx("p",{className:"text-gray-700",children:s&&r?`${i(s,"EEEE, MMMM d, yyyy")} at ${r}`:"Selection incomplete"})]})]}):e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})})},U=()=>{const m=I(),{items:s,setCollectionTime:b}=F(),[r,u]=o.useState(null);o.useEffect(()=>{s.length===0&&m("/")},[s,m]);const h=(c,x)=>{u({date:c,time:x}),b(c,x),m("/checkout")};return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Select Collection Date and Time"}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg mb-8",children:[e.jsx("div",{className:"p-4 border-b text-gray-600",children:"We are open every Thursday, Friday, Saturday and Sunday."}),e.jsx(G,{onConfirm:h})]}),e.jsx("button",{onClick:()=>m("/cart"),className:"w-full bg-gray-200 text-gray-700 py-4 px-6 rounded-lg text-lg font-semibold hover:bg-gray-300 transition-colors",children:"Back to Cart"})]})};export{U as default};
//# sourceMappingURL=TimeSelectionPage-ZVqIhBry.js.map
