import{u as M,j as e}from"./index-YCAMCxzv.js";import{u as O,R as r}from"./vendor-react-S76kyUnC.js";import{u as q}from"./demoModeStore-Ba8Qd-Nc.js";import{i as P,y as E,g as I,z,q as F,x as y,c as h,d as B,f as j,T as R}from"./vendor-firebase-DU3MYe4I.js";import{f as w}from"./vendor-utils-BGzRgZPY.js";const U={apiKey:"AIzaSyCqm49bAzlJwx2SaTXJQZwrBMMM8BtP_1U",authDomain:"bolt-coffee-shop.firebaseapp.com",projectId:"bolt-coffee-shop",storageBucket:"bolt-coffee-shop.firebasestorage.app",messagingSenderId:"921119001263",appId:"1:921119001263:web:59aa28f9f2ce17ebb6225a"},N=P(U),m=E(N);I(N);try{z(m).catch(a=>{a.code==="failed-precondition"?console.warn("Multiple tabs open, persistence enabled in first tab only"):a.code==="unimplemented"&&console.warn("Browser doesn't support persistence")})}catch(a){console.warn("Error enabling persistence:",a)}const H=async(a,l)=>{const n=w(a,"yyyy-MM-dd"),t=F(h(m,"timeSlots"),y("date","==",n),y("time","==",l));return(await B(t)).size<1},J=async(a,l,n)=>{const t=w(a,"yyyy-MM-dd");await j(h(m,"timeSlots"),{date:t,time:l,orderId:n,createdAt:R.now()})},V=()=>{const{items:a,getTotal:l,clearCart:n,collectionTime:t}=M(),{isDemoMode:i}=q(),o=O(),[u,p]=r.useState(!1),[b,v]=r.useState(""),[c,k]=r.useState(!1),[S,x]=r.useState(!1),[f,C]=r.useState("");r.useEffect(()=>{(a.length===0||!t)&&o("/cart")},[a,t,o]);const T=async()=>{if(!t||!c){c||alert("Please accept the terms and conditions to continue.");return}p(!0);try{if(!await H(t.date,t.time)){alert("Sorry, this time slot is no longer available. Please select another time."),o("/collection-time");return}const g={items:a.map(d=>({product:{name:d.product.name,price:Number(d.product.price)},quantity:Number(d.quantity),selectedOption:d.selectedOption||null})),total:Number(l()),pickupDate:t.date.toISOString(),pickupTime:t.time,createdAt:new Date().toISOString(),userId:"guest",userEmail:b||"guest",paymentStatus:i?"completed":"pending",status:"new",notes:f.trim()||null},D=await j(h(m,"orders"),g);await J(t.date,t.time,D.id),o("/confirmation",{state:{orderDetails:g},replace:!0}),setTimeout(()=>n(),100)}catch(s){console.error("Error placing order:",s),alert("There was an error placing your order. Please try again.")}finally{p(!1)}};if(!t)return null;const A=l();return e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Checkout"}),i&&e.jsxs("div",{className:"bg-yellow-100 text-yellow-800 p-4 rounded-lg mb-6",children:[e.jsx("p",{className:"font-medium",children:"Demo Mode Active"}),e.jsx("p",{className:"text-sm",children:"Orders will be processed without real payments."})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Collection Time"}),e.jsxs("p",{className:"text-lg",children:[t.date.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})," at ",t.time]})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Contact Details"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (optional)"}),e.jsx("input",{type:"email",id:"email",value:b,onChange:s=>v(s.target.value),placeholder:"Enter your email for order updates",className:"w-full p-2 border rounded-md"})]})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Order Notes"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Additional Notes (optional)"}),e.jsx("textarea",{id:"notes",value:f,onChange:s=>C(s.target.value),placeholder:"Add any special instructions or notes about your order",className:"w-full p-2 border rounded-md h-32 resize-none"})]})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Order Summary"}),a.map(s=>e.jsxs("div",{className:"flex justify-between mb-3 pb-3 border-b",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.product.name}),e.jsxs("p",{className:"text-sm",children:["Quantity: ",s.quantity]})]}),e.jsxs("p",{className:"font-medium",children:["£",(s.product.price*s.quantity).toFixed(2)]})]},`${s.product.id}-${s.selectedOption||"no-option"}`)),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["£",A.toFixed(2)]})]})})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-4",children:[e.jsx("input",{type:"checkbox",id:"terms",checked:c,onChange:s=>k(s.target.checked),className:"mt-1"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"terms",className:"text-sm text-gray-700",children:"Please check the box to confirm that you have read and accept our terms and conditions."}),e.jsx("button",{onClick:()=>x(!0),className:"text-sm text-blue-600 hover:text-blue-800 ml-1",children:"View Terms"})]})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-lg mx-4",children:[e.jsx("h4",{className:"text-xl font-bold mb-4",children:"Terms and Conditions"}),e.jsxs("div",{className:"text-gray-700 space-y-4",children:[e.jsx("p",{children:"It is the responsibility of the customer to ensure they arrive at their appropriate collection time. Hot drinks will be made for the time booked and stored for a maximum of 15 mins on the warm shelf above the coffee machine. However, given the ambient temperature of the season, it cannot be guaranteed that they will remain at optimum temperature if collected later than the chosen time."}),e.jsx("p",{children:"Unfortunately, drinks that are not collected within the 15 minutes of the time selected, will be disposed of immediately after. Uncollected cakes will be stored for the duration of the van opening hours on the day of booked collection only."}),e.jsx("p",{children:"There will be no refunds for drinks or cakes that are left uncollected."})]}),e.jsx("button",{onClick:()=>x(!1),className:"mt-6 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 w-full",children:"Close"})]})})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>o("/menu"),className:"flex-1 bg-gray-200 text-gray-700 py-4 px-6 rounded-lg text-lg font-semibold hover:bg-gray-300 transition-colors",children:"Continue Shopping"}),e.jsx("button",{onClick:()=>o("/collection-time"),className:"flex-1 bg-gray-200 text-gray-700 py-4 px-6 rounded-lg text-lg font-semibold hover:bg-gray-300 transition-colors",children:"Change Collection Time"}),e.jsx("button",{onClick:T,disabled:u||!c,className:"flex-1 bg-green-600 text-white py-4 px-6 rounded-lg text-lg font-semibold hover:bg-green-700 transition-colors disabled:bg-gray-400",children:u?"Processing...":i?"Place Demo Order":"Place Order"})]})]})};export{V as default};
//# sourceMappingURL=Checkout-B0z6KZWP.js.map
